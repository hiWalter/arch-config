"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[105],{88625:(e,t,o)=>{o.r(t),o.d(t,{SpaceSubscriptionUpdatePaymentMethodModal:()=>B});var r=o(98135),a=o.n(r),n=(o(33948),o(67294)),i=o.n(n),s=o(89940),d=o(45407),p=o(1643),l=o(86664),c=o(16100),u=o(64215),m=o(47966),g=o(58879),v=o(21325),y=o(27832),f=o(97880),b=o(72693),h=o(5366),C=o(82990),S=o(8848),M=o(46951),k=o(78291),P=o(95155);function B(e){return a()(l.Elements,{stripe:(0,c.getStripe)()},void 0,i().createElement(x,e))}function x(e){const[t,o,r]=(0,s.oR)(void 0,d.Z),[c]=(0,s.oR)(k.Z),y=(0,l.useStripe)(),C=(0,l.useElements)(),[S,B]=i().useState(!1),[x,w]=i().useState(void 0),R=(0,g.O7)(),Z=(0,h.YB)(),[,,U]=(0,s.oR)(P.Z);(0,n.useEffect)((()=>{c.data&&!r.isPaymentOptionAvailable("invoice")&&p.BV(p.su(c.data))&&r.addPaymentOption("invoice")}),[R,e.customerData.productId,c,r,U]);const D=i().useCallback(((e,a)=>{t.paymentRequest||(o({...t,paymentRequest:e,supportsApplePay:Boolean(a&&a.applePay)}),r.addPaymentOption("native_payment_platform"))}),[o,r,t]);i().useEffect((()=>{if(y){const t=y.paymentRequest({country:"US",currency:"usd",total:{label:Z.formatMessage({id:"spaceSubscriptionUpdatePaymentMethod.applePay.total.label",defaultMessage:"Notion - You will be charged on a recurring basis"}),amount:0}});t.canMakePayment().then((e=>{e&&D(t,e)})),t.on("token",(t=>{_({environment:R,spaceStore:e.spaceStore,stripeToken:t.token.id,customerData:e.customerData,onComplete:o=>{t.complete(o?"success":"fail"),e.onComplete()}})}))}}),[y,e,Z,R,D]);const T=p.zt(t.availablePaymentMethods),q=(0,u.y)(E,[]);return S?a()("div",{style:q.container},void 0,a()("div",{style:q.header},void 0,a()(h._H,{id:"spaceSubscriptionUpdatePaymentMethod.creditCard.update.header",defaultMessage:"Update credit card"})),a()("div",{style:q.cardContainer},void 0,a()(l.CardElement,{options:{hidePostalCode:!0}})),x&&a()(M.Z,{isMultiline:!1,style:q.error},void 0,x),a()("div",{style:q.upgradeButtonContainer},void 0,a()(b.Z,{style:q.upgradeButton,onClick:()=>async function(e){const{stripe:t,elements:o,environment:r,spaceStore:a,customerData:n,onComplete:i,setError:s}=e;if(!t||!o)return;const d=o.getElement(l.CardElement);if(!d)return;const p=await t.createToken(d);!p.error&&p.token?await _({environment:r,spaceStore:a,stripeToken:p.token.id,customerData:n,onComplete:i}):p.error&&s(p.error.message)}({stripe:y,elements:C,environment:R,spaceStore:e.spaceStore,customerData:e.customerData,onComplete:e.onComplete,setError:w})},void 0,a()(h._H,{id:"spaceSubscriptionUpdatePaymentMethod.creditCard.updateButton",defaultMessage:"Update"})))):a()("div",{style:q.container},void 0,a()("div",{style:q.header},void 0,a()(h._H,{id:"spaceSubscriptionUpdatePaymentMethod.update.header",defaultMessage:"Update payment method"})),a()("div",{style:q.optionGroup},void 0,T.map((({type:o,title:r},n)=>a()("div",{onClick:()=>async function(e){const{newPaymentMethod:t,setCreditCardSelected:o,paymentRequest:r,environment:a,spaceStore:n,onComplete:i}=e;"credit_card"===t?o(!0):"invoice"===t?(await v.Mg({environment:a,spaceStore:n,billing:"send_invoice"}),i()):"native_payment_platform"===t?r&&r.show():(0,f.t1)(t)}({newPaymentMethod:o,paymentRequest:t.paymentRequest,setCreditCardSelected:B,environment:R,spaceStore:e.spaceStore,onComplete:e.onComplete})},o,a()(m.Z,{style:{...q.option,...n!==T.length-1?q.optionBorder:void 0}},void 0,r))))))}async function _(e){const{environment:t,spaceStore:o,stripeToken:r,customerData:a,onComplete:n}=e,{currentUserStore:i}=y.Z.state,s=i?i.getValue():void 0,d=a.billingEmail||(s?s.email:void 0);if(!d)throw new Error("No billing email found.");n(await v.Mg({environment:t,spaceStore:o,billing:"charge_automatically",stripeToken:r,billingEmail:d}))}function E(e){return{container:{width:500,background:e.popoverBackground,padding:30,borderRadius:3},optionGroup:{borderRadius:"2px",background:e.groupedFormBackground,border:"1px solid",borderColor:e.groupedFormBorder},option:{display:"flex",justifyContent:"flex-start",border:"none",height:void 0,paddingTop:"15px",paddingBottom:"15px"},optionBorder:{borderBottom:"1px solid",borderBottomColor:e.groupedFormBorder},header:{fontSize:18,marginBottom:16,fontWeight:C.Z.fontWeight.medium},cardContainer:{backgroundColor:e.groupedFormBackground,borderWidth:1,borderStyle:"solid",borderColor:e.groupedFormBackground,padding:"10px",marginTop:"10px",marginBottom:"10px"},upgradeButtonContainer:{width:"100%",justifyContent:"flex-end",display:"flex"},upgradeButton:{marginTop:"20px"},error:{marginTop:8,color:S.ZP.red}}}},16100:(e,t,o)=>{o.r(t),o.d(t,{injectStripe:()=>c,getStripe:()=>u,translateStripeError:()=>m});var r=o(98135),a=o.n(r),n=o(67294),i=o.n(n),s=o(86664),d=o(97894),p=o(95477);let l=null;function c(e){return t=>a()(s.Elements,{stripe:u()},void 0,a()(s.ElementsConsumer,{},void 0,(({stripe:o,elements:r})=>{const a={...t,stripe:o,elements:r};return i().createElement(e,a)})))}async function u(){return l||(d.loadStripe.setLoadParameters({advancedFraudSignals:!1}),l=(0,d.loadStripe)(p.Z.stripe.key)),l}function m(e,t){if(!t.code)return t.message||"";switch(t.code){case"invalid_expiry_year_past":return e.formatMessage({id:"stripeHelpers.invalidExpiryYear.error.message",defaultMessage:"Your card's expiration year is in the past."});case"invalid_cvc":return e.formatMessage({id:"stripeHelpers.invalidCVC.error.message",defaultMessage:"Your card's security code is invalid."});case"invalid_number":return e.formatMessage({id:"stripeHelpers.invalidNumber.error.message",defaultMessage:"Your card number is not a valid credit card number."});case"card_declined":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message",defaultMessage:"Your card was declined."});default:return t.message||""}}},45407:(e,t,o)=>{o.d(t,{Z:()=>s});o(33948);var r=o(52016),a=o(96486),n=o.n(a);class i extends r.Z{getInitialState(){return{availablePaymentMethods:["credit_card"],paymentRequest:void 0,supportsApplePay:!1}}isPaymentOptionAvailable(e){return this.state.availablePaymentMethods.includes(e)}addPaymentOption(e){const t=n().uniq([...this.state.availablePaymentMethods,e]);this.setState({...this.state,availablePaymentMethods:t})}}const s=i}}]);